<UserControl x:Class="DoorMonitorSystem.Views.DeployView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:dc="clr-namespace:DoorMonitorSystem.ViewModels"
        xmlns:local="clr-namespace:DoorMonitorSystem.Views"
        mc:Ignorable="d"
             Width="900"
        xmlns:Converter="clr-namespace:DoorMonitorSystem.Assets.Converter"
        Background="#0d1117">

    <UserControl.DataContext>
        <dc:DeployViewModel/>
    </UserControl.DataContext>

    <UserControl.Resources>
        <Converter:NullToBoolConverter x:Key="NullToBoolConverter"/>
        <Converter:InverseBoolConverter x:Key="InverseBoolConverter"/>
        <Converter:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>

        <!-- 现代化按钮样式 -->
        <Style x:Key="ModernButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#2196F3"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                               CornerRadius="6"
                               Padding="{TemplateBinding Padding}">
                            <Border.Effect>
                                <DropShadowEffect Color="#2196F3" BlurRadius="8" ShadowDepth="0" Opacity="0.4"/>
                            </Border.Effect>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#1976D2"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#0D47A1"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="#424242"/>
                                <Setter Property="Foreground" Value="#9E9E9E"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 删除按钮样式 -->
        <Style x:Key="DeleteButtonStyle" TargetType="Button" BasedOn="{StaticResource ModernButtonStyle}">
            <Setter Property="Background" Value="#d32f2f"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#f44336"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- 添加按钮样式 -->
        <Style x:Key="AddButtonStyle" TargetType="Button" BasedOn="{StaticResource ModernButtonStyle}">
            <Setter Property="Background" Value="#4CAF50"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#66BB6A"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- 测试按钮样式 -->
        <Style x:Key="TestButtonStyle" TargetType="Button" BasedOn="{StaticResource ModernButtonStyle}">
            <Setter Property="Background" Value="#FF9800"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FFA726"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- 现代化文本框样式 -->
        <Style x:Key="ModernTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="#1a1f2e"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#2a5f8f"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}"
                               BorderBrush="{TemplateBinding BorderBrush}"
                               BorderThickness="{TemplateBinding BorderThickness}"
                               CornerRadius="4">
                            <Grid>
                                <ScrollViewer x:Name="PART_ContentHost"
                                            Margin="{TemplateBinding Padding}"
                                            VerticalAlignment="Center"/>
                                <TextBlock x:Name="Watermark"
                                         Text="{TemplateBinding Tag}"
                                         Foreground="#7b8a9a"
                                         Margin="{TemplateBinding Padding}"
                                         VerticalAlignment="Center"
                                         IsHitTestVisible="False"
                                         Visibility="Collapsed"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="Text" Value="">
                                <Setter TargetName="Watermark" Property="Visibility" Value="Visible"/>
                            </Trigger>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter Property="BorderBrush" Value="#2196F3"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ListBox 项样式 -->
        <Style x:Key="DeviceListItemStyle" TargetType="ListBoxItem">
            <Setter Property="Background" Value="#1a1f2e"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border Background="{TemplateBinding Background}"
                               Padding="{TemplateBinding Padding}"
                               CornerRadius="6"
                               Margin="{TemplateBinding Margin}">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#3a3f9f"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#2a3f5f"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 深色主题 ComboBox 样式 -->
        <Style x:Key="DarkComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Background" Value="#1a1f2e"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#2a5f8f"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Height" Value="50" />
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton x:Name="ToggleButton"
                                        Grid.Column="2"
                                        Focusable="False"
                                        IsChecked="{Binding Path=IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                        ClickMode="Press">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <Border Background="{TemplateBinding Background}"
                                               BorderBrush="{TemplateBinding BorderBrush}"
                                               BorderThickness="{TemplateBinding BorderThickness}"
                                               CornerRadius="4">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <!-- 下拉箭头 -->
                                                <Path Grid.Column="1"
                                                     x:Name="Arrow"
                                                     Data="M 0 0 L 4 4 L 8 0 Z"
                                                     Fill="White"
                                                     HorizontalAlignment="Center"
                                                     VerticalAlignment="Center"
                                                     Margin="0,0,10,0"/>
                                            </Grid>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#2a3f5f"/>
                                            </Trigger>
                                            <Trigger Property="IsChecked" Value="True">
                                                <Setter TargetName="Arrow" Property="Fill" Value="#2196F3"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                                <ToggleButton.Background>
                                    <Binding Path="Background" RelativeSource="{RelativeSource TemplatedParent}"/>
                                </ToggleButton.Background>
                                <ToggleButton.BorderBrush>
                                    <Binding Path="BorderBrush" RelativeSource="{RelativeSource TemplatedParent}"/>
                                </ToggleButton.BorderBrush>
                                <ToggleButton.BorderThickness>
                                    <Binding Path="BorderThickness" RelativeSource="{RelativeSource TemplatedParent}"/>
                                </ToggleButton.BorderThickness>
                            </ToggleButton>

                            <ContentPresenter x:Name="ContentSite"
                                            IsHitTestVisible="False"
                                            Content="{TemplateBinding SelectionBoxItem}"
                                            ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                            ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                            Margin="10,0,30,0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left"/>

                            <Popup x:Name="Popup"
                                  Placement="Bottom"
                                  IsOpen="{TemplateBinding IsDropDownOpen}"
                                  AllowsTransparency="True"
                                  Focusable="False"
                                  PopupAnimation="Slide">
                                <Grid x:Name="DropDown"
                                     SnapsToDevicePixels="True"
                                     MinWidth="{TemplateBinding ActualWidth}"
                                     MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                    <Border x:Name="DropDownBorder"
                                           Background="#1a1f2e"
                                           BorderBrush="#2a5f8f"
                                           BorderThickness="1"
                                           CornerRadius="4"
                                           Margin="0,4,0,0">
                                        <Border.Effect>
                                            <DropShadowEffect Color="Black" BlurRadius="10" ShadowDepth="2" Opacity="0.5"/>
                                        </Border.Effect>
                                        <ScrollViewer Margin="4"
                                                    SnapsToDevicePixels="True">
                                            <StackPanel IsItemsHost="True"
                                                      KeyboardNavigation.DirectionalNavigation="Contained"/>
                                        </ScrollViewer>
                                    </Border>
                                </Grid>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="#7b8a9a"/>
                                <Setter Property="Background" Value="#0d1117"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" Value="#2196F3"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ComboBox 下拉项样式 -->
        <Style x:Key="DarkComboBoxItemStyle" TargetType="ComboBoxItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBoxItem">
                        <Border x:Name="Border"
                               Background="{TemplateBinding Background}"
                               Padding="{TemplateBinding Padding}"
                               CornerRadius="3"
                               Margin="2">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#2196F3"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#1976D2"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280"/>
            <ColumnDefinition Width="20"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 左侧设备列表卡片 -->
        <Border Grid.Column="0"
                Background="#161b22"
                CornerRadius="12"
                BorderBrush="#2a5f8f"
                BorderThickness="1">
            <Border.Effect>
                <DropShadowEffect Color="Black" BlurRadius="15" ShadowDepth="3" Opacity="0.4"/>
            </Border.Effect>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- 标题栏 -->
                <Border Grid.Row="0"
                       Background="#1e3a5f"
                       CornerRadius="12,12,0,0"
                       Padding="16,14">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="🖥️" FontSize="18" Margin="0,0,8,0"/>
                        <TextBlock Text="设备列表"
                                  FontSize="16"
                                  FontWeight="Bold"
                                  Foreground="White"
                                  VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- 设备列表 -->
                <ScrollViewer Grid.Row="1"
                             VerticalScrollBarVisibility="Auto"
                             Padding="12"
                             Background="Transparent">
                    <ListBox ItemsSource="{Binding Devices}"
                            SelectedIndex="{Binding SelectedDeviceIndex, Mode=TwoWay}"
                            SelectedItem="{Binding SelectedDevice}"
                            Background="Transparent"
                            BorderThickness="0"
                            ItemContainerStyle="{StaticResource DeviceListItemStyle}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <TextBlock Text="{Binding Name}"
                                              FontWeight="SemiBold"
                                              FontSize="14"/>
                                    <TextBlock Text="{Binding Protocol}"
                                              FontSize="11"
                                              Foreground="#7b8a9a"
                                              Margin="0,2,0,0"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </ScrollViewer>

                <!-- 操作按钮 -->
                <StackPanel Grid.Row="2" Margin="12,0,12,12">
                    <Button Content="➕ 添加设备"
                           Style="{StaticResource AddButtonStyle}"
                           Command="{Binding AddDeviceCommand}"
                           HorizontalAlignment="Stretch"
                           Margin="0,0,0,8"/>
                    <Button Content="🗑️ 删除设备"
                           Style="{StaticResource DeleteButtonStyle}"
                           Command="{Binding DeleteDeviceCommand}"
                           HorizontalAlignment="Stretch"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 右侧详情编辑卡片 -->
        <Border Grid.Column="2"
                Background="#161b22"
                CornerRadius="12"
                BorderBrush="#2a5f8f"
                BorderThickness="1">
            <Border.Effect>
                <DropShadowEffect Color="Black" BlurRadius="15" ShadowDepth="3" Opacity="0.4"/>
            </Border.Effect>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- 标题栏 -->
                <Border Grid.Row="0"
                       Background="#1e3a5f"
                       CornerRadius="12,12,0,0"
                       Padding="16,14">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="⚙️" FontSize="18" Margin="0,0,8,0"/>
                            <TextBlock Text="设备配置"
                                      FontSize="16"
                                      FontWeight="Bold"
                                      Foreground="White"
                                      VerticalAlignment="Center"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <Button Content="🔌 测试连接"
                                    Style="{StaticResource TestButtonStyle}"
                                    Command="{Binding TestConnectionCommand}"
                                    IsEnabled="{Binding IsTesting, Converter={StaticResource InverseBoolConverter}}"
                                    Margin="0,0,12,0"/>
                            <Button Content="💾 保存配置"
                                    Style="{StaticResource ModernButtonStyle}"
                                    Command="{Binding SaveCommand}"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- 内容区 -->
                <ScrollViewer Grid.Row="1"
                             VerticalScrollBarVisibility="Auto"
                             Padding="20"
                             Background="Transparent">
                    <StackPanel>
                        <!-- 基本信息卡片 -->
                        <Border Background="#1a1f2e"
                               CornerRadius="8"
                               Padding="16"
                               Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="📋 基本信息"
                                          FontSize="14"
                                          FontWeight="Bold"
                                          Foreground="#2196F3"
                                          Margin="0,0,0,12"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="20"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- 设备名称 -->
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="设备名称"
                                                  FontSize="12"
                                                  Foreground="#7b8a9a"
                                                  Margin="0,0,0,6"/>
                                        <TextBox Style="{StaticResource ModernTextBoxStyle}"
                                                Tag="请输入设备名称"
                                                Text="{Binding SelectedDevice.Name, UpdateSourceTrigger=PropertyChanged}"/>
                                    </StackPanel>

                                    <!-- 协议类型 -->
                                    <StackPanel Grid.Column="2"  >
                                        <TextBlock Text="协议类型"
                                                  FontSize="12"
                                                  Foreground="#7b8a9a"
                                                  Margin="0,0,0,6"/>
                                        <ComboBox ItemsSource="{Binding ProtocolKeys}" 
                                                 SelectedIndex="{Binding SelectedProtocolIndex}"
                                                 SelectedItem="{Binding SelectedDevice.Protocol}"
                                                 Style="{StaticResource DarkComboBoxStyle}"
                                                 ItemContainerStyle="{StaticResource DarkComboBoxItemStyle}"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- 通信参数卡片 -->
                        <Border Background="#1a1f2e"
                               CornerRadius="8"
                               Padding="16"
                               Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="🔌 通信参数配置"
                                          FontSize="14"
                                          FontWeight="Bold"
                                          Foreground="#2196F3"
                                          Margin="0,0,0,12"/>

                                <DataGrid ItemsSource="{Binding SelectedDevice.CommParsams}"
                                         SelectedIndex="{Binding SelectedparaIndex, Mode=TwoWay}"
                                         AutoGenerateColumns="False"
                                         CanUserAddRows="False"
                                         HeadersVisibility="Column"
                                         GridLinesVisibility="All"
                                         HorizontalGridLinesBrush="#1e2433"
                                         VerticalGridLinesBrush="#1e2433"
                                         Background="Transparent"
                                         Foreground="White"
                                         BorderThickness="0"
                                         RowBackground="Transparent"
                                         RowHeaderWidth="0"
                                         SelectionMode="Single"
                                         SelectionUnit="FullRow"
                                         ColumnHeaderHeight="40"
                                         RowHeight="45">
                                    <DataGrid.Resources>
                                        <Style TargetType="DataGridRow">
                                            <Setter Property="Background" Value="#1a1f2e"/>
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter Property="Background" Value="#3a3f9f"/>
                                                </Trigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#252b3d"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGrid.Resources>
                                    <DataGrid.ColumnHeaderStyle>
                                        <Style TargetType="DataGridColumnHeader">
                                            <Setter Property="Background" Value="#2a5f8f"/>
                                            <Setter Property="Foreground" Value="White"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                            <Setter Property="Padding" Value="15,0"/>
                                            <Setter Property="BorderThickness" Value="0,0,1,0"/>
                                            <Setter Property="BorderBrush" Value="#1e2433"/>
                                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                                        </Style>
                                    </DataGrid.ColumnHeaderStyle>
                                    <DataGrid.CellStyle>
                                        <Style TargetType="DataGridCell">
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="DataGridCell">
                                                        <Border Background="{TemplateBinding Background}" Padding="15,0">
                                                            <Grid>
                                                                <ContentPresenter VerticalAlignment="Center"/>
                                                                <!-- 底端虚线 -->
                                                                <Separator VerticalAlignment="Bottom" Background="Transparent" BorderBrush="#2a2f3a" BorderThickness="0,0,0,1" Margin="-15,0"/>
                                                            </Grid>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                            <Style.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter Property="Background" Value="Transparent"/>
                                                    <Setter Property="Foreground" Value="White"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGrid.CellStyle>
                                    <DataGrid.Columns>
                                        <!-- 参数名称 -->
                                        <DataGridTemplateColumn Header="参数名称" Width="180" IsReadOnly="True">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Text="🔹" Margin="0,0,8,0" VerticalAlignment="Center" FontSize="10"/>
                                                        <TextBlock Text="{Binding Name}"
                                                                  FontWeight="SemiBold"
                                                                  Foreground="#e1e4e8"
                                                                  VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>

                                        <!-- 参数值 -->
                                        <DataGridTemplateColumn Header="参数值" Width="*">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Value}"
                                                              Foreground="#2196F3"
                                                              FontWeight="Medium"
                                                              VerticalAlignment="Center"/>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                            <DataGridTemplateColumn.CellEditingTemplate>
                                                <DataTemplate>
                                                    <TextBox Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                                                            Style="{StaticResource ModernTextBoxStyle}"
                                                            Padding="5,2"
                                                            Height="30"
                                                            VerticalAlignment="Center"
                                                            VerticalContentAlignment="Center"/>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellEditingTemplate>
                                        </DataGridTemplateColumn>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>

                        <!-- 测试连接页脚提示 -->
                        <Border Margin="0,15,0,0"
                                Padding="12,10"
                                Background="#0d1117"
                                CornerRadius="6"
                                BorderBrush="#2a2f3a"
                                BorderThickness="1"
                                Visibility="{Binding TestStatusMessage, Converter={StaticResource StringToVisibilityConverter}}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Orientation="Horizontal" Grid.Column="0">
                                    <!-- 加载动画 -->
                                    <TextBlock Text="🔄" FontSize="14" Margin="0,0,10,0" Foreground="#2196F3" VerticalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsTesting}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                    
                                    <!-- 信息图标 -->
                                    <TextBlock Text="ℹ️" FontSize="14" Margin="0,0,10,0" Foreground="#7b8a9a" VerticalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Visible"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsTesting}" Value="True">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </StackPanel>

                                <TextBlock Grid.Column="1"
                                           Text="{Binding TestStatusMessage}"
                                           FontSize="13"
                                           Foreground="#e1e4e8"
                                           TextWrapping="Wrap"
                                           VerticalAlignment="Center"/>
                            </Grid>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>

</UserControl>
