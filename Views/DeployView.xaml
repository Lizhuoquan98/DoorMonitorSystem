<UserControl  x:Class="DoorMonitorSystem.Views.DeployView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:dc="clr-namespace:DoorMonitorSystem.ViewModels"
        xmlns:local="clr-namespace:DoorMonitorSystem.Views"
        mc:Ignorable="d" 
        xmlns:Converter="clr-namespace:DoorMonitorSystem.Assets.Converter"
        Height="350" Width="500">

    <UserControl.DataContext>
        <dc:DeployViewModel/> 
    </UserControl.DataContext>

    <UserControl.Resources>
        <Converter:NullToBoolConverter x:Key="NullToBoolConverter"/>
        <Style x:Key="WatermarkTextBoxStyle" TargetType="TextBox">
            <Setter Property="Foreground" Value="Black"/> 
            <Setter Property="Padding" Value="4"/>
            <Setter Property="Width" Value="100"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Grid>
                            <ScrollViewer x:Name="PART_ContentHost"
                                      Background="White"
                                      Margin="0"/>

                            <Border x:Name="WatermarkBorder" 
                                    BorderBrush="Black"
                                    BorderThickness="1"
                                    Padding="4"
                                    CornerRadius="2"/>  
                            <Label x:Name="Watermark"
                                       Content="{TemplateBinding Tag}"
                                       Foreground="Black"
                                       Opacity="0.5"
                                       IsHitTestVisible="False"
                                       Visibility="Collapsed"/>

                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="Text" Value="">
                                <Setter TargetName="Watermark" Property="Visibility" Value="Visible"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="DarkGray"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="150"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 左侧设备列表 -->
        <ListBox ItemsSource="{Binding Devices}" 
                 SelectedIndex="{Binding SelectedDeviceIndex, Mode=TwoWay}" 
                 SelectedItem="{Binding SelectedDevice}" DisplayMemberPath="Name"/>

        <!-- 右侧参数编辑 -->
        <Grid Grid.Column="1" Margin="5,0,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Orientation="Horizontal">
                <Button Content="增加设备" Width="80" Margin="0,5,0,0" Command="{Binding AddDeviceCommand}" />
                <Button Content="删除设备" Width="80" Margin="5,5,0,0" Command="{Binding AddDeviceCommand}" />
                <Button Content="保存设置" Width="80" Margin="5,5,0,0" Command="{Binding SaveCommand}" />
            </StackPanel>


            <StackPanel Grid.Row="1"  Orientation="Horizontal" Margin="0,10">
                <TextBox   Style="{StaticResource  WatermarkTextBoxStyle}"  Tag="请输入设备名称"   Text="{Binding SelectedDevice.Name, UpdateSourceTrigger=PropertyChanged}" />
                <TextBox   Style="{StaticResource  WatermarkTextBoxStyle}"   Tag="请输入设备ID"    Margin="10,0" Text="{Binding SelectedDevice.ID}"  />
                <!--<TextBox   Style="{StaticResource  WatermarkTextBoxStyle}"   Tag="请输入协议类型"  Text="{Binding SelectedDevice.Protocol}" />-->
                <ComboBox ItemsSource="{Binding ProtocolKeys}" SelectedIndex="{Binding SelectedProtocolIndex}" SelectedItem="{Binding SelectedDevice.Protocol}" Width="120"    />

            </StackPanel>

            <DataGrid Grid.Row="2" Margin="0,10,0,0"
                      ItemsSource="{Binding SelectedDevice.CommParsams}"
                       SelectedIndex="{Binding SelectedparaIndex, Mode=TwoWay}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      HeadersVisibility="Column"
                      GridLinesVisibility="All"
                      BorderBrush="Gray" BorderThickness="1">
                <DataGrid.Columns>  
                    <DataGridTemplateColumn Header="参数名" Width="*">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                <Label Content="{Binding Name}" /> 
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn> 
                    <DataGridTextColumn Header="参数值"      Binding="{Binding Value}" Width="2*" />
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </Grid>

</UserControl>
