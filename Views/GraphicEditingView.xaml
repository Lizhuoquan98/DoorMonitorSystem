<UserControl x:Class="DoorMonitorSystem.Views.GraphicEditingView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:DoorMonitorSystem.ViewModels"
             xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             mc:Ignorable="d" 
              Background="AliceBlue">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition  Width="Auto"/>
            <ColumnDefinition  Width="290"/> 
        </Grid.ColumnDefinitions>

        <!-- 输入区域 -->
        <StackPanel Grid.Row="0" Width="300" Margin="10">
            <TextBlock Text="路径 Data:"/>
            <TextBox Height="150" TextWrapping="Wrap"
                     Text="{Binding PathDataText, UpdateSourceTrigger=PropertyChanged}">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="TextChanged">
                        <i:InvokeCommandAction Command="{Binding TextChangedCommand}"
                                               CommandParameter="{Binding Text, RelativeSource={RelativeSource  AncestorType=TextBox}}"/>
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </TextBox>

            <StackPanel Orientation="Horizontal">
                <StackPanel Margin="2" Width="96">
                    <TextBlock Text="描边颜色:" Margin="0,10,0,0"/>
                    <xctk:ColorPicker SelectedColor="{Binding StrokeColor}" />
                </StackPanel>
                <StackPanel Margin="2" Width="96">
                    <TextBlock Text="填充颜色:" Margin="0,10,0,0"/>
                    <xctk:ColorPicker SelectedColor="{Binding FillColor}" />
                </StackPanel>
                <StackPanel Margin="2" Width="96">
                    <TextBlock Text="线宽:" Margin="0,10,0,0"/>
                    <TextBox Text="{Binding Thickness}" Height="23"/>
                </StackPanel>
            </StackPanel>

            <StackPanel Orientation="Horizontal">
                <Button Width="96" Content="添加图形" Margin="2,1" Command="{Binding AddCommand}"/>
                <Button Width="96" Content="删除图形" Margin="2,1" Command="{Binding DeleteCommand}"/>
                <Button Width="96" Content="清空画布" Margin="2,1" Command="{Binding ClearCommand}"/>
            </StackPanel>

            <TextBlock Text="图形预览:" Margin="0,10,0,0"/>
            <Border BorderBrush="Gray" BorderThickness="1">
                <Viewbox Width="290" Height="290">
                    <Grid>
                        <Path Stroke="{Binding StrokeBrush}"  Width="1024" Height="1024"
                              Fill="{Binding FillBrush}"
                              StrokeThickness="{Binding Thickness}"
                              Data="{Binding PathData}" />
                    </Grid>
                </Viewbox>
            </Border>
        </StackPanel>

        <StackPanel   Grid.Column="1">
            <StackPanel Orientation="Horizontal" Margin="0,15,0,0">
                <TextBlock Padding="1" Text="图形名称:"/>
                <TextBox Padding="1" VerticalContentAlignment="Center" Text="{Binding IconName}" Width="100"/>
                <Button Padding="2,0" Margin="10,0,0,0" Content="保存到图形字典"   Command="{Binding SaveCommand}"/>
            </StackPanel>

            <TextBlock Text="组合图形:" Margin="0,15,0,0"/>
            <Border Background="Aquamarine">
                <Viewbox Width="500" Height="500" Stretch="Uniform">
                    <ItemsControl ItemsSource="{Binding PathItems}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <Canvas Width="1024" Height="1024"  Background="White"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Path Stroke="{Binding Stroke}" Fill="{Binding Fill}" StrokeThickness="{Binding StrokeThickness}" 
                                        Data="{Binding Data}">
                                    <i:Interaction.Triggers>
                                        <i:EventTrigger EventName="MouseLeftButtonDown">
                                            <i:InvokeCommandAction
                                    Command="{Binding DataContext.SelectCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                    CommandParameter="{Binding}" />
                                        </i:EventTrigger>
                                    </i:Interaction.Triggers>
                                </Path>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Viewbox>
            </Border>

        </StackPanel>

        <StackPanel Margin="10" Grid.Column="2">
            <StackPanel Orientation="Horizontal" Margin="0,10"> 
                <TextBlock Text="图形数据字典预览：" FontSize="16" FontWeight="Bold" />

                <!--<Button Padding="2,0" Margin="10,0,0,0" Content="导入字典" FontSize="14"   Command="{Binding ImportDictionaryCommand}"/>-->

                <Button Padding="2,0" Margin="10,0,0,0" Content="导出字典" FontSize="14"   Command="{Binding ExportDictionaryCommand}"/>
            </StackPanel>
            
            <!-- 添加 ScrollViewer 支持滚动 -->
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Height="620">
                <ItemsControl ItemsSource="{Binding GraphicGroups}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="0,10">
                                <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="14" Margin="0,5"/>
                                <Border BorderBrush="Gray" BorderThickness="1">
                                    <Viewbox Width="200" Height="200">
                                        <ItemsControl ItemsSource="{Binding Items}">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <Canvas Width="1024" Height="1024" Background="White"/>
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Path Stroke="{Binding Stroke}"
                                                  Fill="{Binding Fill}"
                                                  StrokeThickness="{Binding StrokeThickness}"
                                                  Data="{Binding Data}" />
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </Viewbox>
                                </Border>
                            </StackPanel>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </StackPanel> 

    </Grid>
</UserControl>
